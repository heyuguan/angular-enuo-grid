angular.module("enuo.grid",[]).run(["$templateCache",function(n){n.put("enuo/grid/templates/emptyResult.html",'<div class="row" ng-style="outStyle">\n    <div class="col-md-4 col-md-offset-4" ng-style="innerStyle">\n        <div class="media">\n            <div class="media-left">\n                <i style="font-size:42px;" ng-class="config.icon"></i>\n            </div>\n            <div class="media-body">\n                <h4 class="media-heading">{{ config.title }}</h4>\n                {{ config.intro }}\n            </div>\n        </div>\n    </div>\n</div>'),n.put("enuo/grid/templates/enuoGrid.html",'<div class="enuo-grid">\n    <div class="box-tool clearfix">\n        <div class="btn-group" ng-if="config.tool">\n            <button ng-repeat="item in config.tool.items" type="button" ng-click="item.click(selectedList)" class="btn btn-default" ng-class="item.cssClass">\n                <i ng-class="item.icon"></i> {{item.name}}\n            </button>\n        </div>\n        <div class="pull-right" ng-if="config.query">\n            <form class="form-inline">\n                <div class="input-group">\n                    <div class="pull-left" ng-repeat="item in config.query.items">\n                        <div ng-if="item.type==\'select\'" class="input-group-btn">\n                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n                                 {{ item.display }} \n                                 <span class="caret"></span>\n                            </button>\n                            <ul class="dropdown-menu">\n                                <li ng-repeat="option in item.options" ng-click="fnSelectQuery(option,item)">\n                                    <a>{{option.name}}</a>\n                                </li>\n                            </ul>\n                        </div>\n                        <input ng-if="item.type==\'input\'" type="text" ng-model="item.value" class="form-control" placeholder="{{item.placeholder}}" />\n                        <input ng-if="item.type==\'hideen\'" type="hidden" ng-model="item.value" />\n                    </div>\n                    <span class="input-group-btn pull-left">\n                        <button type="submit" ng-click="fnQuery()" class="btn btn-primary">\n                            <i class="glyphicon glyphicon-search"></i>\n                            {{config.query.action.title || \'搜索\'}}\n                        </button>\n                    </span>\n                </div>\n            </form>\n        </div>\n    </div>\n    <table class="table table-bordered table-hover">\n        <thead>\n            <tr>\n                <th style="width:10px;"><input type="checkbox" ng-model="checkAll" ng-click="fnCheckAll()"></th>\n                <th ng-repeat="column in config.columns" ng-style="{width:column.width?column.width:\'auto\'}">{{column.name}}</th>\n            </tr>\n        </thead>\n        <tbody ng-if="!config.loading && gridSource.length > 0">\n            <tr ng-repeat="item in gridSource" ng-click="fnCheckItem(item)">\n                <td>\n                    <input type="checkbox" ng-checked="fnItemChecked(item)">\n                </td>\n                <td ng-repeat="column in config.columns">\n                    <enuo-grid-cell column="column" item="item"></enuo-grid-cell>\n                </td>\n            </tr>\n        </tbody>\n        <tbody ng-if="!config.loading && gridSource.length <= 0">\n            <tr>\n                <td colspan="{{config.columns.length + 1}}">\n                    <empty-result></empty-result>\n                </td>\n            </tr>\n        </tbody>\n        <tbody ng-if="config.loading">\n            <tr>\n                <td colspan="{{config.columns.length + 1}}">\n                    <empty-result em-style="loading"></empty-result>\n                </td>\n            </tr>\n        </tbody>\n    </table>\n    <div class="box-footer" ng-if="config.page">\n        <paging page="config.page.pageIndex" class="pull-right paging" page-size="config.page.pageSize" total="config.page.total" paging-action="config.page.callback(page)" show-prev-next="true" show-first-last="true">\n        </paging>\n    </div>\n</div>')}]);
angular.module("enuo.grid").directive("paging",function(){function t(t,a){t.List=[],t.Hide=!1,t.page=parseInt(t.page)||1,t.total=parseInt(t.total)||0,t.adjacent=parseInt(t.adjacent)||2,t.pgHref=t.pgHref||"",t.dots=t.dots||"...",t.ulClass=t.ulClass||"pagination",t.activeClass=t.activeClass||"active",t.disabledClass=t.disabledClass||"disabled",t.textFirst=t.textFirst||"<<",t.textLast=t.textLast||">>",t.textNext=t.textNext||">",t.textPrev=t.textPrev||"<",t.textFirstClass=t.textFirstClass||"",t.textLastClass=t.textLastClass||"",t.textNextClass=t.textNextClass||"",t.textPrevClass=t.textPrevClass||"",t.textTitlePage=t.textTitlePage||"Page {page}",t.textTitleFirst=t.textTitleFirst||"First Page",t.textTitleLast=t.textTitleLast||"Last Page",t.textTitleNext=t.textTitleNext||"Next Page",t.textTitlePrev=t.textTitlePrev||"Previous Page",t.hideIfEmpty=e(t,a.hideIfEmpty),t.showPrevNext=e(t,a.showPrevNext),t.showFirstLast=e(t,a.showFirstLast),t.scrollTop=e(t,a.scrollTop),t.isDisabled=e(t,a.disabled)}function e(t,e){return!!angular.isDefined(e)&&!!t.$parent.$eval(e)}function a(t,e){t.page>e&&(t.page=e),t.page<=0&&(t.page=1),t.adjacent<=0&&(t.adjacent=2),e<=1&&(t.Hide=t.hideIfEmpty)}function s(t,e){t.page!=e&&(t.isDisabled||(t.page=e,t.pagingAction({page:t.page,pageSize:t.pageSize,total:t.total}),t.scrollTop&&scrollTo(0,0)))}function i(t,e,a){if(!(!t.showPrevNext&&!t.showFirstLast||e<1)){var i,l,r;if("prev"===a){i=t.page-1<=0;var n=t.page-1<=0?1:t.page-1;t.showFirstLast&&(l={value:t.textFirst,title:t.textTitleFirst,aClass:t.textFirstClass,page:1}),t.showPrevNext&&(r={value:t.textPrev,title:t.textTitlePrev,aClass:t.textPrevClass,page:n})}else{i=t.page+1>e;var g=t.page+1>=e?e:t.page+1;t.showPrevNext&&(l={value:t.textNext,title:t.textTitleNext,aClass:t.textNextClass,page:g}),t.showFirstLast&&(r={value:t.textLast,title:t.textTitleLast,aClass:t.textLastClass,page:e})}var p=function(e,a){return{title:e.title,aClass:e.aClass,value:e.aClass?"":e.value,liClass:a?t.disabledClass:"",pgHref:a?"":t.pgHref.replace(x,e.page),action:function(){a||s(t,e.page)}}};if(t.isDisabled&&(i=!0),l){var o=p(l,i);t.List.push(o)}if(r){var d=p(r,i);t.List.push(d)}}}function l(t,e,a){var i=0;for(i=t;i<=e;i++){var l=a.pgHref.replace(x,i),r=a.page==i?a.activeClass:"";a.isDisabled&&(l="",r=a.disabledClass),a.List.push({value:i,title:a.textTitlePage.replace(x,i),liClass:r,pgHref:l,action:function(){s(a,this.value)}})}}function r(t){t.List.push({value:t.dots,liClass:t.disabledClass})}function n(t,e){l(1,2,t),3!=e&&r(t)}function g(t,e,a){a!=t-2&&r(e),l(t-1,t,e)}function p(e,s){(!e.pageSize||e.pageSize<=0)&&(e.pageSize=1);var r=Math.ceil(e.total/e.pageSize);t(e,s),a(e,r);var p,x,o=2*e.adjacent+2;i(e,r,"prev"),r<=o+2?l(p=1,r,e):e.page-e.adjacent<=2?(l(p=1,x=1+o,e),g(r,e,x)):e.page<r-(e.adjacent+2)?(p=e.page-e.adjacent,x=e.page+e.adjacent,n(e,p),l(p,x,e),g(r,e,x)):(x=r,n(e,p=r-o),l(p,x,e)),i(e,r,"next")}var x=/\{page\}/g;return{restrict:"EA",link:function(t,e,a){t.$watchCollection("[page,pageSize,total,disabled]",function(e,s){p(t,a)},!0)},template:function(t,e){return'<ul data-ng-hide="Hide" data-ng-class="ulClass"> <li title="{{Item.title}}" data-ng-class="Item.liClass" data-ng-repeat="Item in List"> <a '+(e.pgHref?'data-ng-href="{{Item.pgHref}}" ':"href ")+'data-ng-class="Item.aClass" data-ng-click="Item.action()" data-ng-bind="Item.value"></a> </li></ul>'},scope:{page:"=",pageSize:"=",total:"=",disabled:"@",dots:"@",ulClass:"@",activeClass:"@",disabledClass:"@",adjacent:"@",pagingAction:"&",pgHref:"@",textFirst:"@",textLast:"@",textNext:"@",textPrev:"@",textFirstClass:"@",textLastClass:"@",textNextClass:"@",textPrevClass:"@",textTitlePage:"@",textTitleFirst:"@",textTitleLast:"@",textTitleNext:"@",textTitlePrev:"@"}}});
angular.module("enuo.grid").directive("emptyResult",function(){return{restrict:"EA",scope:{height:"@",emTitle:"@",emIntro:"@",emIcon:"@",emStyle:"@"},replace:!0,templateUrl:"enuo/grid/templates/emptyResult.html",controller:["$scope","$element","$attrs",function(e,t,n){e.$watchGroup(["height","emTitle","emIntro","emIcon","emStyle"],function(t,n){e.fnUpdate()},!0),e.fnUpdate=function(){e.config={title:e.emTitle||"没有匹配的数据",icon:e.emIcon||"glyphicon glyphicon-info-sign text-yellow",intro:e.emIntro||"请尝试修改查询条件后再试一次。"},"loading"==e.emStyle&&(e.config.title="loading",e.config.intro="正在加载,请稍后...",e.config.icon="fa fa-refresh fa-spin text-muted");var t=e.height||200,n=(t-60)/2;e.outStyle={"min-height":t+"px"},e.innerStyle={"margin-top":n+"px"}}}]}});
angular.module("enuo.grid").directive("enuoGridCell",function(){return{restrict:"EA",replace:!0,transclude:!0,scope:{column:"=",item:"="},template:'<span ng-click="click()"></span>',compile:function(){return{pre:function($scope,$elm,$attrs){function getFunc(func){return angular.isFunction(func)?func:eval("("+func+")")}var value=$scope.item[$scope.column.key];value||(value=$scope.column.name),$scope.column.format&&(value=getFunc($scope.column.format)(value,$scope.item)),"add"==$scope.column.template?$elm.append("<a class='text-green text-link'><i class='ion-plus-round'></i> "+value+"</a>"):"edit"==$scope.column.template?$elm.append("<a class='text-light-blue text-link'><i class='ion-edit'></i> "+value+"</a>"):"delete"==$scope.column.template?$elm.append("<a class='text-red text-link'><i class='ion-trash-a'></i> "+value+"</a>"):$scope.column.template?$elm.append(getFunc($scope.column.template)(value,$scope.item)):$elm.append(value)},post:function($scope,$elm,$attrs){$scope.click=function(){if($scope.column.click){var invoke;invoke=angular.isFunction($scope.column.click)?$scope.column.click:eval("("+$scope.column.click+")"),invoke($scope.item[$scope.column.name],$scope.item)}}}}}}});
angular.module("enuo.grid").directive("enuoGrid",function(){return{restrict:"E",replace:!0,scope:{config:"=",gridSource:"="},templateUrl:"enuo/grid/templates/enuoGrid.html",controller:["$scope","$element","$attrs",function(e,c,n){e.selectedList=[],e.checkAll=!1,e.fnItemChecked=function(c){var n=c[e.config.pkid];return e.selectedList.indexOf(n)>-1},e.fnCheckItem=function(c){var n=c[e.config.pkid],t=e.selectedList.indexOf(n);t>-1?e.selectedList.splice(t,1):e.selectedList.push(n),e.checkAll=e.selectedList.length==e.gridSource.length},e.fnCheckAll=function(){var c=[];e.checkAll&&angular.forEach(e.gridSource,function(n,t,i){c.push(n[e.config.pkid])}),e.selectedList=c},e.$watch("gridSource",function(c,n){e.checkAll=!1,e.selectedList=[]},!0),e.fnSelectQuery=function(e,c){c.value=e.value,c.display=e.display||e.name},e.fnQuery=function(){var c={};angular.forEach(e.config.query.items,function(e,n,t){c[e.key]=e.value}),e.config.query.action.callback(c)}}]}});